# QuantConnect Agent 团队使用指南

本指南详细介绍三大 Agent 的功能定位、应用场景和协作模式，帮助你高效利用 AI 助手完成量化开发任务。

## 🚀 Agent 团队概览

### 快速选择指南
- **遇到问题？** → 找 🔍 策略医生
- **想改进代码？** → 找 📐 代码架构师  
- **需要测试？** → 找 🧪 测试工程师
- **复杂任务？** → 三者协作

### Agent 定位
1. **测试工程师** - 质量保证专家，确保代码可靠性
2. **代码架构师** - 设计优化专家，提升代码质量
3. **策略医生** - 问题诊断专家，分析解决难题

---

## 📋 详细功能拆解

### 1. 🧪 测试工程师 (quantconnect-test-engineer)

#### 核心功能
- **单元测试创建**：为每个函数/方法编写独立测试
- **集成测试设计**：验证模块间交互的正确性
- **测试数据生成**：创建各种市场场景的模拟数据
- **Mock 对象构建**：模拟 QuantConnect 框架组件
- **覆盖率分析**：评估测试的完整性
- **边界条件测试**：极端情况下的行为验证
- **性能基准测试**：确保代码运行效率

#### 典型应用场景
```
✅ "为新的波动率计算模块创建测试"
✅ "测试风控在极端市场条件下的表现"
✅ "验证订单执行逻辑的各种边界情况"
✅ "确保代码重构后功能不受影响"
✅ "创建回归测试防止 bug 重现"
```

#### 工作产出
- 完整的测试套件（unit/integration/mocks）
- 测试运行脚本
- 覆盖率报告
- 测试文档

---

### 2. 📐 代码架构师 (code-architect)

#### 核心功能
- **架构设计**：设计新模块与现有系统的集成方案
- **代码重构**：优化代码结构，提高可维护性
- **性能优化**：解决 MCMC 采样、数据处理等性能瓶颈
- **设计模式应用**：引入适合的设计模式
- **模块化改造**：将复杂逻辑拆分为可复用组件
- **最佳实践**：确保符合 QuantConnect 和 Python 规范
- **技术债务管理**：识别并解决技术债务

#### 典型应用场景
```
✅ "设计一个新的自适应止损模块"
✅ "优化 AlphaModel 的 MCMC 性能"
✅ "重构 PortfolioConstruction 使其支持多策略"
✅ "将硬编码的参数改为可配置"
✅ "简化复杂的嵌套逻辑"
```

#### 工作产出
- 优化后的代码
- 架构设计文档
- 重构计划
- 性能改进报告

---

### 3. 🔍 策略医生 (strategy-doctor)

#### 核心功能
- **回测日志分析**：深入解读下载的回测结果
- **问题诊断**：分析为什么某些信号没有触发
- **异常检测**：发现异常的交易模式或行为
- **性能分析**：识别策略表现不佳的时期和原因
- **决策链追踪**：重建完整的交易决策过程
- **瓶颈定位**：找出代码或逻辑的性能瓶颈
- **改进建议**：基于诊断结果提供优化建议

#### 典型应用场景
```
✅ "分析为什么 2023 年 Q4 回撤这么大"
✅ "为什么 AAPL-MSFT 对今天没有生成信号"
✅ "回测显示频繁止损，帮我找原因"
✅ "OrderTracker 似乎漏记了一些交易"
✅ "MCMC 采样为什么这么慢"
```

#### 工作产出
- 问题诊断报告
- 根因分析
- 改进建议
- 性能分析图表

---

## 🤝 协作模式

### 场景 1：添加新功能
```
代码架构师 → 测试工程师 → 策略医生
设计方案  →  创建测试  →  验证效果
```

**实例：添加 VIX 动态仓位调整**
1. **代码架构师**：设计 VIXAdjustment 模块结构
2. **测试工程师**：创建 VIX 场景测试
3. **策略医生**：分析回测中 VIX 调整效果

### 场景 2：解决问题
```
策略医生 → 代码架构师 → 测试工程师
诊断问题 → 设计方案  →  防止复现
```

**实例：频繁止损问题**
1. **策略医生**：发现回撤计算有误导致频繁止损
2. **代码架构师**：重新设计回撤计算逻辑
3. **测试工程师**：创建止损场景的回归测试

### 场景 3：性能优化
```
策略医生 → 代码架构师 → 测试工程师
定位瓶颈 → 优化实现  →  性能测试
```

**实例：MCMC 性能问题**
1. **策略医生**：定位 MCMC 采样是性能瓶颈
2. **代码架构师**：优化算法，添加缓存
3. **测试工程师**：创建性能基准测试

---

## 💡 实战案例

### 案例 1：完整开发周期
```
需求："添加基于市场情绪的仓位调整"

1️⃣ 代码架构师
   ├─ 设计 SentimentAnalysis 模块
   ├─ 确定与 AlphaModel 的接口
   └─ 提供实现方案

2️⃣ 测试工程师
   ├─ 创建情绪数据 Mock
   ├─ 编写不同情绪场景测试
   └─ 验证仓位调整逻辑

3️⃣ 实施后回测...

4️⃣ 策略医生
   ├─ 分析情绪指标的预测效果
   ├─ 识别哪些市场环境下最有效
   └─ 建议阈值优化
```

### 案例 2：紧急问题处理
```
问题："策略突然大幅回撤"

1️⃣ 策略医生（紧急诊断）
   ├─ 分析最近的交易日志
   ├─ 发现：新加入的科技股配对异常
   └─ 诊断：协整关系破裂但未及时平仓

2️⃣ 代码架构师（快速修复）
   ├─ 添加协整关系实时监控
   └─ 设计紧急平仓机制

3️⃣ 测试工程师（确保稳定）
   ├─ 测试协整破裂的检测
   └─ 验证紧急平仓逻辑
```

---

## 🎯 使用建议

### 单独使用
- **日常开发**：主要使用代码架构师
- **问题排查**：优先使用策略医生
- **质量保证**：定期使用测试工程师

### 组合使用
- **新功能开发**：架构师 + 测试工程师
- **性能优化**：医生 + 架构师
- **重大重构**：三者全部参与

### 最佳实践
1. **先诊断后优化**：不确定问题时，先找策略医生
2. **设计先行**：大的改动先咨询代码架构师
3. **测试驱动**：重要功能都要有对应测试
4. **持续改进**：定期让策略医生体检

---

## 📊 Agent 能力矩阵

| 能力领域 | 测试工程师 | 代码架构师 | 策略医生 |
|---------|-----------|-----------|----------|
| 代码设计 | ⭐⭐ | ⭐⭐⭐⭐⭐ | ⭐⭐ |
| 问题诊断 | ⭐⭐ | ⭐⭐⭐ | ⭐⭐⭐⭐⭐ |
| 质量保证 | ⭐⭐⭐⭐⭐ | ⭐⭐⭐ | ⭐⭐ |
| 性能优化 | ⭐⭐⭐ | ⭐⭐⭐⭐ | ⭐⭐⭐⭐ |
| 回测分析 | ⭐ | ⭐⭐ | ⭐⭐⭐⭐⭐ |

---

## 🔧 快速启动

```bash
# 遇到问题
"策略医生，帮我分析为什么最近止损频繁"

# 改进代码  
"代码架构师，帮我优化 AlphaModel 的性能"

# 创建测试
"测试工程师，为新的风控模块创建测试"

# 组合使用
"策略医生诊断问题后，请代码架构师设计解决方案"
```

记住：每个 Agent 都是你的专业助手，合理使用它们将大大提升你的开发效率！