# 如何读取回测报告

从 v7.1.6 版本开始，完整的回测报告不再打印到日志，而是保存到 QuantConnect 的 ObjectStore 云端存储中，避免超过 100KB 日志限制。

## 方法一：使用 LEAN CLI 命令下载（推荐）

### 本地回测后读取

本地回测会自动将 ObjectStore 数据保存到项目目录：
```bash
# 1. 运行回测
lean backtest BayesCointegration

# 2. 查看 ObjectStore 文件
# 文件位置: BayesCointegration/backtests/<backtest-name>/code/<project-id>/object_store/backtest_report.txt

# 示例路径
type "backtests\2025-01-25_12-30-45\code\12345678\object_store\backtest_report.txt"
```

### 云端回测后下载

```bash
# 1. 运行云端回测
lean cloud backtest BayesCointegration

# 2. 下载回测结果（包含 ObjectStore 数据）
lean cloud backtest results <backtest-id> --destination ./backtests/

# 3. 查看报告文件
# 文件位置: backtests/<backtest-id>/object_store/backtest_report.txt
```

## 方法二：在 QuantConnect 网页端查看

1. 访问 https://www.quantconnect.com
2. 登录账号，进入项目
3. 点击左侧菜单 "Object Store"
4. 找到 `backtest_report.txt` 文件
5. 点击查看或下载

## 方法三：在代码中读取（用于后续回测）

如果你想在下一次回测中读取之前的报告：

```python
def OnEndOfAlgorithm(self):
    # 读取上次回测的报告
    if self.ObjectStore.ContainsKey("backtest_report.txt"):
        previous_report = self.ObjectStore.Read("backtest_report.txt")
        self.Debug("[历史报告] 上次回测报告:")
        self.Debug(previous_report)

    # 保存本次报告（覆盖旧报告）
    current_report = self._generate_report()
    self.ObjectStore.Save("backtest_report.txt", current_report)
```

## 报告内容说明

完整报告包含以下维度分析（约 60 行）：

### 1. 基础摘要
- 总交易次数
- 总盈亏
- 平均持仓天数

### 2. Top 5 最佳/最差配对
- 配对ID（如 (AAPL, MSFT)）
- 总盈亏
- 胜率
- 交易次数

### 3. 行业表现
- 各行业总盈亏
- 胜率
- 交易次数
- 平均持仓天数

### 4. 平仓原因分析
- CLOSE：正常信号平仓
- STOP_LOSS：止损平仓
- PAIR_TIMEOUT：持仓超时
- PAIR_DRAWDOWN：配对回撤
- 各原因的胜率、平均收益、跑赢SPY比例

### 5. SPY基准对比
- 跑赢SPY比例
- 平均超额收益（Alpha）
- 超额收益标准差

## 日志中的精简摘要

回测结束时，Debug日志只会打印 5 行摘要：
```
============================================================
[回测报告] 交易历史统计分析
============================================================
总交易次数: 174, 总盈亏: $12,345.67
最佳配对: ('AAPL', 'MSFT') ($5,432.10, 胜率=75.0%)
最差配对: ('BAC', 'JPM') ($-2,345.67, 胜率=33.3%)
[回测报告] 完整报告已保存到 ObjectStore: backtest_report.txt
============================================================
```

## 常见问题

### Q: ObjectStore 文件会一直保留吗？
A: 是的，文件会持久保存在 QuantConnect 账户中，除非你手动删除。每次新回测会覆盖同名文件。

### Q: ObjectStore 有容量限制吗？
A: 免费账户有 5GB 总容量限制，单个文本报告通常只有几KB，不用担心容量问题。

### Q: 本地回测的 ObjectStore 数据保存在哪里？
A: `项目目录/backtests/<回测名称>/code/<项目ID>/object_store/`

### Q: 如何清空 ObjectStore？
```bash
# 删除特定文件
lean cloud object-store delete backtest_report.txt

# 或在代码中删除
self.ObjectStore.Delete("backtest_report.txt")
```

## 优势总结

✅ **不受100KB日志限制** - 报告再详细也不会被截断
✅ **保留完整分析** - 60行详细统计数据完整保存
✅ **日志更简洁** - Debug只显示5行关键摘要
✅ **持久化存储** - 可随时下载查看历史报告
✅ **自动化处理** - 无需手动操作，回测结束自动保存
