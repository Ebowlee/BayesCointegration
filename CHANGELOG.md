# 贝叶斯协整策略更新日志

版本格式：v<主>.<次>.<修>[_描述][@日期]

---

## [v2.7.8_margin-mechanism-fix@20250723]
### 工作内容
- 实施QuantConnect保证金机制修复，通过CustomSecurityInitializer确保SecurityMarginModel正确配置
- 增强保证金验证诊断功能，提供详细的保证金模型配置信息和异常分析
- 建立完整的保证金效率监控体系，帮助识别和诊断保证金配置问题
- 为保证金机制异常提供详细的解决建议和算法调整方案

### 技术细节
- 核心修复：在main.py中添加CustomSecurityInitializer
  - 为每个股票证券设置SecurityMarginModel(2.0)确保2倍杠杆（50%保证金率）
  - 配置ImmediateSettlementModel确保保证金账户立即结算
  - 添加保证金配置日志便于验证初始化过程
- 保证金诊断增强：
  - 检查每个持仓证券的保证金模型类型和杠杆配置
  - 监控保证金效率异常时的详细诊断信息（>1.8x）
  - 提供UniverseSettings.Leverage配置检查
  - 当保证金效率>2.5x时建议算法调整方案

### 预期效果
- 做空头寸应正确使用50%保证金而非100%资金
- 保证金效率监控值应接近1.0x（理想状态）
- 提高整体资金利用率，减少"资金积压"问题
- 为后续算法优化提供详细的保证金配置诊断信息

## [v2.7.6_portfolio-api-fix@20250723]
### 工作内容
- 修复QuantConnect Portfolio API属性名称错误，解决保证金监控功能的语法问题
- 统一使用Python snake_case命名规范，确保与QuantConnect框架兼容
- 完善保证金机制验证和资金分配监控功能
- 添加订单大小预检查机制，主动避免minimum order size警告

### 技术细节
- 核心修复：`SecurityPortfolioManager`对象属性名称标准化
  - `TotalBuyingPower` → `cash + margin_remaining`（计算购买力）
  - `TotalPortfolioValue` → `total_portfolio_value`
  - `TotalMarginUsed` → `total_margin_used`
  - `MarginRemaining` → `margin_remaining`
  - `Keys` → `keys`
- SecurityHolding属性标准化：
  - `Invested` → `invested`
  - `Quantity` → `quantity`
  - `HoldingsValue` → `holdings_value`
- 预检机制：`_check_minimum_order_size()`方法在生成PortfolioTarget前验证订单规模

### 架构影响
- 消除语法错误：Portfolio API调用完全兼容QuantConnect框架
- 增强监控能力：保证金使用效率分析、预期vs实际资金分配对比
- 提前问题发现：订单大小预检查避免运行时警告
- 代码质量提升：统一命名规范，提高代码可维护性

### 调查成果
- 创建详细的保证金调查报告：`MARGIN_INVESTIGATION_REPORT.md`
- 确认保证金配置正确：`SetBrokerageModel(InteractiveBrokers, Margin)`有效
- 识别资金利用率偏低的潜在原因：需要通过监控验证保证金机制实际效果
- 建立完整的诊断体系：从配置验证到实时监控的全链路分析

### 下一步计划
- 运行修复后的回测，观察保证金监控数据
- 验证保证金使用效率是否接近理论值（0.5x）
- 根据监控结果优化资金分配算法或识别配置问题
- 建立基于实际数据的保证金机制优化方案

## [v2.7.5_margin-leverage-investigation@20250723]
### 工作内容
- 初步优化保证金配置，为深度调查QuantConnect保证金机制做准备
- 发现资金利用率偏低问题，疑似保证金机制未正确生效
- 添加资金状态监控功能，实时跟踪保证金使用情况
- 保留最小订单限制作为资金分配问题的早期警告信号

### 技术细节
- 杠杆配置：在main.py中添加`UniverseSettings.Leverage = 2.0`提升总可用资金
- 资金监控：在PortfolioConstruction中新增`_log_portfolio_status()`方法
- 监控指标：总资产、现金、已用保证金、购买力、资金利用率等关键指标
- 日志优化：删除UniverseSelection中的无用调度日志，进一步精简输出

### 问题发现
- **资金利用率异常**：理论上8个协整对应各占12.5%资金，实际单笔交易仅$5k-$15k
- **保证金机制疑问**：做空头寸可能未按50%保证金计算，而是100%资金占用
- **最小订单警告**：出现单股交易推荐，暴露资金分配深层问题

### 架构影响
- 建立资金使用透明度：通过监控功能实时观察保证金机制是否生效
- 保持问题可见性：保留最小订单限制，让资金分配问题及时暴露
- 为深度调查奠定基础：杠杆配置提升资金上限，监控功能提供调查数据

### 下一步计划
- **深度调查QuantConnect保证金机制**：研究文档确认配置要求
- **验证资金分配算法**：检查数学公式与实际执行的差异
- **根因分析最小订单警告**：找出单股交易推荐的具体原因
- **制定针对性修复方案**：基于调查结果优化保证金配置或算法逻辑

## [v2.7.4_add-trading-cooling-mechanism@20250723]
### 工作内容
- 添加交易冷却机制，防止频繁的摇摆交易
- 解决T-TMUS类型的短期平仓-建仓循环问题
- 实现配置化的冷却期管理，提升策略稳定性
- 优化交易决策逻辑，减少不必要的交易成本

### 技术细节
- 冷却期配置：默认7天冷却期，通过main.py配置'cooling_period_days'参数
- 数据结构：添加pair_cooling_history字典记录配对平仓时间
- 检查逻辑：建仓信号需通过_is_in_cooling_period检查，冷却期内自动忽略
- 历史记录：每次平仓执行时调用_record_cooling_history记录时间
- 双向检查：支持(symbol1,symbol2)和(symbol2,symbol1)的双向键查询

### 架构影响
- 信号验证增强：在_validate_signal中集成冷却期检查
- 配置扩展：PortfolioConstruction支持cooling_period_days配置参数
- 日志完善：冷却期触发时输出详细的剩余天数信息
- 防摇摆机制：从根本上解决频繁平仓-建仓的低效交易

### 预期解决的问题
**T-TMUS摇摆交易案例**：
- 8/5平仓 → 8/6建仓：冷却机制将阻止8/6的建仓信号
- 8/15平仓 → 8/20建仓：冷却机制将阻止8/20前的建仓信号
- 减少交易频率，降低交易成本，提升策略收益稳定性

### 配置参数
- `cooling_period_days`: 7天（可调整）
- 支持后续根据策略表现优化冷却期长度

### 下一步计划
- 基于冷却机制进行回测验证，观察摇摆交易的改善效果
- 评估冷却期长度的最优设置，平衡交易机会与稳定性
- 考虑针对不同波动率特征的配对设置差异化冷却期

## [v2.7.3_ultra-log-reduction@20250723]
### 工作内容
- 进一步大幅削减日志输出，实现极致精简提升可读性
- 删除AlphaModel所有信号相关日志，消除信号生成噪音
- 删除PortfolioConstruction统计日志，只保留实际交易执行信息
- 标准化代码注释标点符号为英文格式，提升代码规范性

### 技术细节
- AlphaModel信号日志删除：移除买|卖信号打印和"生成信号: X对"统计
- PC统计日志删除：移除"信号处理"和"生成X组PortfolioTarget"统计
- 保留关键日志：只保留实际交易执行、Beta超限警告、信号转换提示
- 标点符号标准化：153个中文标点符号替换为英文标点符号

### 架构影响
- 日志量再次大幅减少：预计在v2.7.2基础上再减少80%
- 信噪比显著提升：消除冗余统计信息，突出核心交易行为
- 代码规范性提升：统一英文标点符号，符合国际化编码标准
- 调试效率提升：日志更聚焦于实际问题和关键决策点

### 日志精简效果对比
**v2.7.2前**：16页日志（3个月回测）
**v2.7.3后**：预计<2页日志（3个月回测）
**核心保留**：实际交易执行、风险控制警告、特殊情况转换

### 下一步计划
- 基于极简日志进行回测验证，确保关键信息不丢失
- 评估是否需要可选的详细日志模式用于深度调试
- 考虑添加关键性能指标的定期汇总日志

## [v2.7.2_log-optimization@20250723]
### 工作内容
- 优化日志输出机制，大幅减少冗余信息提升可读性
- 移除AlphaModel中的Beta筛选逻辑，简化建模统计
- 精简信号日志输出，只保留关键交易信息
- 将Beta筛选移至PortfolioConstruction保持架构清晰

### 技术细节
- 粗选日志调整：从select_coarse移至select_fine，在选股标题后输出
- 删除重复日志：AlphaModel的"选股日, 接收到"与后续统计重复
- 消除"复用"概念：移除混淆的预建模机制，简化为动态更新vs完整建模
- 信号日志精简：只输出买|卖信号，不输出回归/观望信号
- PC日志优化：删除忽略信号日志，保留信号转换日志（特殊性）
- Beta筛选位置：从_BuildPairTargets开头处筛选，范围0.2-3.0

### 架构影响
- 职责分离更清晰：AlphaModel专注统计信号生成，PC负责仓位和基础风控
- 日志量大幅减少：预计减少70%+的冗余输出
- 代码逻辑简化：消除了复杂的"复用"机制，提升可维护性
- 保留关键信息：有效交易、信号转换、Beta超限警告

### 日志精简效果
- 删除：无效回归信号、忽略信号、重复接收日志
- 保留：有效交易信号、实际执行交易、特殊信号转换
- 结果：3个月回测从16页日志预计减少至5页以内

### 下一步计划
- 基于精简后的日志进行回测验证
- 考虑增加日志级别控制，支持详细/简洁模式切换
- 进一步优化其他模块的日志输出

## [v2.7.1_capital-allocation-optimization-beta-filter@20250723]
### 工作内容
- 重构资金分配算法，实现100%资金利用率和精确Beta中性风险对冲
- 添加Beta范围筛选功能，过滤极端beta值的协整对提升策略稳定性
- 优化建模流程，复用Beta筛选结果避免重复计算提升性能

### 技术细节
- 全新资金分配算法：基于协整关系y=beta×x和保证金机制的数学模型
- 情况1（y多x空）：y_fund=c×beta/(m+beta), x_fund=c×m/(m+beta)
- 情况2（y空x多）：y_fund=c×m×beta/(1+m×beta), x_fund=c/(1+m×beta)
- 权重转换机制：做多权重=资金，做空权重=资金/保证金率
- Beta筛选范围：0.2 ≤ abs(beta) ≤ 3.0，在FilterCointegratedPairs中实现
- 预建模优化：Beta筛选时进行PyMC建模，后续流程复用posterior_param结果

### 架构影响
- 实现真正的100%资金利用率，每个配对精确使用分配的资金额度
- 保证Beta中性：杠杆后购买力严格满足协整关系，确保风险对冲效果
- 建模效率提升：避免重复PyMC建模，将建模统计细分为复用/动态更新/完整建模三类
- 策略稳定性增强：极端beta的协整对被过滤，降低单一股票风险集中度

### 数学验证
- 资金平衡验证：y_fund + x_fund = capital_per_pair（精确到1e-10）
- Beta中性验证：leveraged_position_ratio = beta_relationship（精确到1e-10）
- 多场景测试：标准(beta=1.5)、高Beta(beta=2.0)、低Beta(beta=0.8)、极限Beta(beta=3.0)全部通过

### 配置新增
- `min_beta_threshold`: 0.2，Beta最小阈值，过滤极小beta的协整对
- `max_beta_threshold`: 3.0，Beta最大阈值，过滤极大beta的协整对

### 下一步计划
- 基于新的资金分配进行回测，验证100%资金利用率的实际效果
- 根据Beta筛选结果，评估是否需要动态调整beta阈值范围
- 考虑添加基于波动率的动态资金分配权重调整

## [v2.7.0_portfolio-construction-signal-filter@20250723]
### 工作内容
- 完善PortfolioConstruction模块，实现智能信号过滤和持仓管理功能
- 建立基于Portfolio API的实时持仓检查机制
- 实现配置化架构，支持从StrategyConfig统一管理参数
- 优化信号有效期，平仓信号1天、建仓信号2天有效期

### 技术细节
- 修改构造函数支持config参数，从配置中读取margin_rate等参数
- 新增`_get_pair_position_status`方法，使用`algorithm.Portfolio[symbol].Invested`检查持仓状态
- 实现`_validate_signal`智能验证机制：平仓信号需有持仓、同向建仓忽略、反向建仓转平仓
- 重构`create_targets`方法，集成完整的信号处理流程和统计功能
- 增强日志输出：提供信号过滤统计（总计/有效/忽略/转换组数）和详细决策信息
- 在main.py中正式启用PortfolioConstruction模块，支持测试模式和正常模式切换

### 架构影响
- 实现真正的模块解耦：PortfolioConstruction专注信号过滤，AlphaModel专注统计信号生成
- 使用QuantConnect原生Portfolio API，无需维护内部状态，确保持仓检查的实时性和准确性
- 建立清晰的信号处理规则，避免重复建仓和摇摆交易，提升策略稳定性
- 完成从信号生成到仓位管理的完整交易执行链路

### 信号处理规则
- **平仓信号**：必须有持仓才有效，避免无效平仓操作
- **建仓信号**：未持仓时执行，已持仓同方向时忽略（防重复建仓）
- **反向信号**：自动转换为平仓信号，避免摇摆交易和风险累积
- **信号有效期**：平仓1天、建仓2天，适配Daily分辨率的实际交易需求

### 下一步计划
- 启用和完善RiskManagement模块，建立多层风险控制机制
- 基于实际交易结果，优化信号过滤参数和持仓管理策略
- 考虑添加部分平仓和动态仓位调整功能

## [v2.6.5_debug-log-cleanup@20250722]
### 工作内容
- 清理调试日志以减少日志冗余，优化回测输出的可读性
- 保留核心业务错误日志，确保监控和异常诊断能力
- 简化数据统计和初始化日志，专注于关键性能指标

### 技术细节
- 移除动态更新过程的详细调试信息（[Debug]标签日志）
- 移除MCMC采样开始/结束状态日志
- 移除先验参数详情和数据获取成功日志
- 简化数据质量统计，仅显示总计和有效数量
- 保留协整检验异常、PyMC导入错误等关键错误日志

### 架构影响
- 大幅减少日志输出量，提升回测执行效率
- 保持核心监控能力，便于生产环境问题排查
- 为最终部署版本奠定清洁的日志基础

## [v2.6.4@20250722]
### 工作内容
- 完善动态贝叶斯更新配置参数，支持用户自定义选股间隔和更新策略
- 同步main.py配置与AlphaModel实现，确保动态更新功能完整可用

### 技术细节
- 新增`selection_interval_days`: 30天，支持自定义选股间隔周期
- 新增`dynamic_update_enabled`: True，提供动态更新功能开关
- 配置参数与v2.6.3的AlphaModel实现完全匹配，支持跨选股周期的后验参数传递

### 架构影响
- 完成动态贝叶斯更新的配置层面集成，用户可灵活调整更新策略
- 为后续的参数优化和策略调整提供配置基础

## [v2.6.3_data-quality-optimize@20250722]
### 工作内容
- 重构数据检查架构，建立基础集中化+业务分散化的信任链设计
- 消除重复数据验证，大幅简化代码逻辑和提升执行效率
- 提升数据完整性标准从80%至95%，确保协整检验统计有效性
- 实现动态贝叶斯更新功能，支持历史后验作为先验分布

### 技术细节
- 数据质量集中化：`_BatchLoadHistoricalData`建立3级基础分类（basic_valid, data_complete, price_valid）
- 消除重复检查：移除长度验证、空值检查、数据一致性等4项重复验证，减少~50行冗余代码
- 信任链架构：下游函数信任上游质量保证，专注各自业务逻辑验证
- 动态建模统一：`PyMCModel`支持完整建模和动态更新两种模式，轻量级采样配置
- 数据填充优化：forward fill + backward fill处理零散缺失，最多允许13天缺失（5.2%容忍度）

### 架构影响
- 建立清晰的数据质量信任链，避免重复验证提升性能
- 实现职责分离：基础数据处理vs业务逻辑验证的明确边界
- 支持动态贝叶斯更新，历史后验参数跨选股周期传递
- 简洁优雅的设计原则：最小修改实现最大效果

### 数据质量提升
- 数据完整性要求：从80%（202天）提升至95%（239天）
- 协整检验统计有效性显著增强，减少填充数据对分析结果的影响
- 保持现有填充机制的简洁性，平衡统计严格性与数据可用性

### 下一步计划
- 考虑进一步提升数据完整性标准至97-98%，将缺失容忍度控制在安全范围
- 基于动态更新结果，优化MCMC采样参数和先验分布设置
- 监控数据填充的实际影响，评估对协整关系识别的统计偏差

## [v2.6.2@20250722]
### 工作内容
- 优化AlphaModel关键参数配置，提升协整对筛选质量和建模效率
- 调整波动率、相关性、配对数量等核心阈值，平衡策略收益与风险
- 清理回测历史文件，保持项目结构整洁

### 技术细节
- 相关性阈值优化：从0.2提升至0.5，提高协整对预筛选标准
- 配对数量控制：从5对降至4对，降低组合复杂度和风险集中度
- MCMC采样效率：burn-in和draws从1500降至1000，平衡精度与性能
- 波动率筛选严格化：从60%降至45%，筛选更稳定的股票
- 项目维护：清理过期回测文件，新增Pensive Yellow Caribou回测结果

### 架构影响
- 参数调优基于v2.6.1的日志优化，形成"监控→分析→优化"的迭代循环
- 更严格的筛选标准提升策略质量，为后续数据质量重构奠定基础
- MCMC性能优化为动态更新功能预留计算资源

### 参数对比
| 参数 | v2.6.1 | v2.6.2 | 优化目的 |
|------|--------|--------|----------|
| correlation_threshold | 0.2 | 0.5 | 提高协整对质量 |
| max_pairs | 5 | 4 | 降低组合风险 |
| mcmc_burn_in/draws | 1500 | 1000 | 平衡性能精度 |
| max_volatility_3month | 0.6 | 0.45 | 筛选稳定股票 |

### 下一步计划
- 基于优化参数的回测结果，进一步调整协整检验和建模阈值
- 实施数据质量架构重构，支持更严格的筛选标准
- 开发动态贝叶斯更新，提升模型适应性

## [v2.6.1_alphamodel-log-optimize@20250722]
### 工作内容
- 优化AlphaModel日志输出，减少冗余信息提升回测日志可读性
- 合并波动率筛选的多行输出为简洁的单行格式，详细信息内嵌
- 改进行业协整对报告，分离统计汇总和具体配对信息
- 实现每日信号生成的条件日志输出，仅在有意义时记录

### 技术细节
- 波动率筛选日志优化：将原来的2行输出（总体统计+明细统计）合并为1行，使用`候选45只 → 通过38只 (波动率过滤5只, 数据缺失2只)`格式
- 行业协整对日志分层：第1行显示行业统计汇总`Technology(2) Healthcare(1)`，第2行显示具体配对`Technology[AAPL-MSFT,GOOG-META]`
- 每日信号日志条件化：仅在`signal_count > 0 or insight_blocked_count > 0`时输出，避免无意义的"观望"日志
- 新增`insight_no_active_count`计数器追踪观望状态，提供完整的信号生成统计

### 架构影响
- 显著减少回测日志冗余，提升日志分析效率和可读性
- 保持所有关键信息的完整性，优化信息展示方式而非删除信息
- 建立条件化日志输出模式，为其他模块的日志优化提供参考
- 增强协整对信息的层次化展示，便于快速定位和分析

### 下一步计划
- 实施动态贝叶斯更新：使用历史后验作为新一轮选股的先验
- 对重复协整对使用最近30天数据进行似然更新，避免重新建模
- 建立后验参数存储机制，支持跨选股周期的参数传递

## [v2.6.0_alpha-config-volatility@20250721]
### 工作内容
- AlphaModel完成配置化架构改造，统一使用StrategyConfig集中管理参数
- 波动率筛选功能从UniverseSelection迁移到AlphaModel，实现更合理的筛选位置
- 实施批量数据缓存机制，显著优化History API调用性能
- 增强性能监控和详细日志输出，提供各处理阶段的耗时统计

### 技术细节
- 修改`BayesianCointegrationAlphaModel.__init__()`构造函数：从`__init__(self, algorithm)`改为`__init__(self, algorithm, config)`
- 将15个硬编码参数全部迁移到配置字典：协整检验、MCMC采样、信号阈值、波动率筛选等
- 新增`_BatchLoadHistoricalData()`方法：一次API调用获取所有股票历史数据并缓存，替代N次单独调用
- 新增`_VolatilityFilter()`方法：基于缓存数据计算3个月年化波动率，筛选低于60%的股票
- 实现详细性能监控：记录缓存、波动率、协整检验、MCMC各阶段耗时，总计耗时统计
- 更新main.py中StrategyConfig.alpha_model配置，增加波动率相关参数：`max_volatility_3month`、`volatility_lookback_days`

### 架构影响
- AlphaModel实现完全配置化，与StrategyConfig紧密集成，消除硬编码参数
- 建立批量数据处理模式，将API调用从O(N)优化为O(1)，显著提升性能
- 实现筛选职责合理分配：UniverseSelection负责基础筛选，AlphaModel负责策略相关筛选
- 统一各模块配置架构模式，为PortfolioConstruction配置化提供清晰参考
- 建立性能监控标准，为后续性能优化提供量化指标

### 性能优化
- 批量数据缓存：消除重复History API调用，预期性能提升80%以上
- 基于缓存的协整检验：避免PyMCModel中重复数据获取
- 详细耗时统计：便于识别性能瓶颈和优化效果评估

### 下一步计划
- 继续推进PortfolioConstruction配置化改造，完成算法框架的全面配置化
- 基于性能监控数据，进一步优化MCMC采样和协整检验的算法效率
- 评估波动率筛选迁移后的选股效果，优化筛选参数和逻辑

## [v2.5.2_universe-log-enhance@20250721]
### 工作内容
- 优化UniverseSelection日志输出，增强选股过程可观测性
- 添加行业分布统计，显示各行业最终选出的股票数量
- 添加财务筛选详细统计，显示各财务指标过滤的股票数量
- 改进日志格式，提供更清晰的选股过程信息

### 技术细节
- 在`_select_fine`方法中添加行业分布计算逻辑，统计通过财务筛选后各行业的股票数量
- 增加财务筛选失败原因统计：`pe_failed`, `roe_failed`, `debt_failed`, `leverage_failed`, `data_missing`
- 优化日志输出格式：使用箭头符号`候选163只 → 通过56只 (过滤107只)`提升可读性
- 新增两条关键日志：`财务过滤明细: PE(25) ROE(18)...` 和 `行业分布: Tech(12) Health(8)...`
- 改进错误处理：异常信息限制50字符，使用更简洁的`财务数据异常`标签

### 架构影响
- 提升UniverseSelection模块的调试和监控能力，便于参数优化
- 保持代码简洁性，所有改进不影响选股性能
- 建立了清晰的日志分层：基础统计 → 详细分解 → 行业分布 → 最终结果
- 为后续其他模块的日志优化提供了参考模式

### 下一步计划
- 基于增强的日志信息，分析各财务指标的筛选效果，优化阈值设置
- 继续推进AlphaModel配置化改造，将硬编码参数迁移到StrategyConfig
- 根据行业分布统计，评估30只/行业配置的实际效果

## [v2.5.1_config-simplify@20250720]
### 工作内容
- 简化UniverseSelection配置逻辑，删除冗余的向后兼容代码
- 强制使用集中配置，提高代码一致性和可维护性
- 消除重复代码，符合DRY原则

### 技术细节
- 修改`MyUniverseSelectionModel.__init__()`方法，移除了v2.5.0中的默认参数和向后兼容逻辑
- 强制要求`config`参数传入，删除了`if config is None`的分支处理
- 所有配置参数直接从`config`字典读取：`self.num_candidates = config['num_candidates']`
- 清理了不再需要的默认值设置代码，确保配置来源唯一性

### 架构影响
- UniverseSelection模块完全配置化，与StrategyConfig类紧密集成
- 消除了配置不一致的风险，所有参数必须通过集中配置传入
- 为后续AlphaModel和PortfolioConstruction配置化提供了清晰的架构模式

### 下一步计划
- 对AlphaModel进行相同的配置化改造，将15个硬编码参数迁移到StrategyConfig.alpha_model
- 建立统一的配置验证机制，确保所有模块配置的完整性和正确性

## [v2.5.0_centralized-config@20250720]
### 工作内容
- 实施策略参数集中管理架构
- 创建StrategyConfig类统一管理所有模块配置
- UniverseSelection支持配置传入，保持向后兼容
- 为AlphaModel和PortfolioConstruction配置奠定基础

### 技术细节
- 在`main.py`中创建`StrategyConfig`类，包含所有模块的配置参数
- 定义了三个主要配置字典：`universe_selection`、`alpha_model`、`portfolio_construction`
- 修改`MyUniverseSelectionModel.__init__()`签名：从`__init__(self, algorithm)`改为`__init__(self, algorithm, config)`
- 实现向后兼容逻辑：当`config=None`时使用默认配置，确保现有代码不会破坏
- 在`BayesianCointegrationStrategy.Initialize()`中创建配置实例并传递给UniverseSelection

### 架构影响
- 建立了统一的配置管理模式，所有模块参数将集中在StrategyConfig中
- 实现了配置与业务逻辑的分离，便于参数调优和维护
- 为策略的可配置化奠定了基础架构，支持后续快速扩展其他模块

### 遗留问题
- AlphaModel和PortfolioConstruction仍使用硬编码参数，需要在后续版本中配置化
- 配置验证机制尚未建立，需要添加参数有效性检查

### 下一步计划
- 简化UniverseSelection配置逻辑，移除向后兼容代码
- 对AlphaModel进行配置化改造，集成贝叶斯模型的所有参数

## [v2.4.9_universe-config-volatility@20250720]
### 工作内容
- 实施UniverseSelection参数配置化架构
- 新增波动率筛选功能（60%年化上限）
- 完善错误处理机制和详细日志输出
- 支持灵活的选股参数调整和验证

### 技术细节
- 重构`MyUniverseSelectionModel.__init__()`方法，将所有硬编码参数改为配置参数
- 新增8个可配置参数：`num_candidates`, `min_price`, `min_volume`, `min_ipo_days`, `max_pe`, `min_roe`, `max_debt_to_assets`, `max_leverage_ratio`
- 实现波动率筛选逻辑：计算过去252天的年化波动率，过滤超过60%的股票
- 增强错误处理：对财务数据异常情况添加try-catch和详细日志记录
- 改进日志格式：统一使用`[UniverseSelection]`前缀，提供筛选过程的详细统计信息

### 架构影响
- 首次引入配置化概念，为后续StrategyConfig架构奠定基础
- 提高选股模块的灵活性，支持不同市场环境下的参数调优
- 建立了错误处理和日志记录的标准模式

### 新增功能
- 波动率筛选：基于历史价格数据计算年化波动率，提升选股质量
- 参数验证：对配置参数进行基本的有效性检查
- 详细统计：提供每个筛选步骤的通过/过滤股票数量统计

### 下一步计划
- 建立StrategyConfig类，实现所有模块的集中配置管理
- 扩展配置化架构到AlphaModel和PortfolioConstruction模块

## [v2.4.8_strategy-optimize@20250720]
### 工作内容
- 优化主策略初始化流程和模块集成
- 完善AlphaModel贝叶斯协整检验参数
- 改进UniverseSelection选股筛选条件
- 修复.gitignore文件编码问题并完善忽略规则

### 技术细节
- 优化`BayesianCointegrationStrategy.Initialize()`方法的模块初始化顺序和参数设置
- 调整AlphaModel中的关键参数：协整检验p值阈值(0.025)、MCMC采样参数(1500 burn-in + 1500 draws)
- 完善UniverseSelection的财务筛选条件：PE比率、ROE、债务比率等指标的阈值优化
- 修复.gitignore文件编码问题(BOM头)，增加Python项目相关的忽略规则
- 改进模块间的调度机制，确保月度选股和日度信号生成的协调

### 架构影响
- 建立了更稳定的模块初始化和运行流程
- 优化了策略的整体性能和稳定性
- 为后续配置化改造提供了更清晰的参数基准

### 问题修复
- 解决了.gitignore文件编码导致的版本控制问题
- 修复了模块间数据传递的潜在同步问题
- 完善了错误处理和异常情况的处理逻辑

### 下一步计划
- 实施UniverseSelection的参数配置化，引入波动率筛选功能
- 建立统一的配置管理架构，为所有模块的配置化奠定基础

## [v2.4.7.1] 
- (之前的提交记录)

## [v2.4.7]
- (之前的提交记录)

---

## 版本管理规范

### 版本号格式
```
v<主>.<次>.<修>[_描述][@日期]
```

### 版本说明
- **主版本**: 大变动/接口变更/架构重构
- **次版本**: 主要功能、算法升级、新模块  
- **修订号**: 小修复、参数调整、细节完善
- **描述**: 1-2词点明本次版本最大特征或主题
- **日期**: @YYYYMMDD格式，便于回溯

### CHANGELOG条目标准模板

每个版本更新应包含以下四个部分：

```markdown
## [v<版本号>]
### 工作内容
- 主要完成的任务和功能变更
- 用简洁的语言描述做了什么

### 技术细节
- 具体的代码修改和实现方法
- 文件变更、函数修改、新增逻辑等
- 参数调整、配置变更等技术细节

### 架构影响
- 对整体项目架构的影响和改进
- 模块间关系的变化
- 为后续开发带来的便利或约束

### 下一步计划
- 基于当前改动，明确后续开发方向
- 为新对话提供明确的起点和目标
- 识别需要解决的遗留问题
```

### 特殊情况处理
- **遗留问题**: 当存在已知但未解决的问题时，在相应版本中增加"遗留问题"部分
- **问题修复**: 当主要工作是修复bug时，增加"问题修复"部分详细说明
- **新增功能**: 当引入重要新功能时，增加"新增功能"部分突出说明